<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ==============================
         HMS MAIN MENU STRUCTURE
         ============================== -->

    <!-- Root menu for Hospital Management System -->
    <record id="hms_menu_root" model="ir.ui.menu">
        <field name="name">HMS</field>
        <field name="parent_id" eval="False"/>
        <field name="sequence" eval="10"/>
    </record>

    <!-- ==============================
         PATIENT MODULE
         ============================== -->

    <!-- Patient window action -->
    <record id="hms_patient_action" model="ir.actions.act_window">
        <field name="name">Patients</field>
        <field name="res_model">hms.patient</field>
        <field name="view_mode">tree,form</field>
    </record>

    <!-- Patient menu item -->
    <record id="hms_patient_menu" model="ir.ui.menu">
        <field name="name">Patients</field>
        <field name="parent_id" ref="hms_menu_root"/>
        <field name="sequence" eval="10"/>
        <field name="action" ref="hms_patient_action"/>
    </record>

    <!-- Patient form view -->
    <record id="hms_patient_form_view" model="ir.ui.view">
        <field name="name">hms.patient.form</field>
        <field name="model">hms.patient</field>
        <field name="groups_id" eval="[(4, ref('hms.group_hms_manager'))]"/>
        <field name="arch" type="xml">
            <form string="Patient">
                <sheet>
                    <header>
                        <button name="print_patient_status_report" type="object" string="Print Status Report" class="btn-primary"/>
                    </header>
                    <group>
                        <group string="Personal Information">
                            <field name="first_name"/>
                            <field name="last_name"/>
                            <field name="email" widget="email" placeholder="patient@example.com"/>
                            <field name="birth_date" required="1" help="Age will be automatically calculated from birth date"/>
                            <field name="image" widget="image"/>
                            <field name="address"/>
                        </group>
                        <group string="Medical Information">
                            <field name="history" invisible="age &lt; 50"/>
                            <field name="cr_ratio" required="pcr"/>
                            <field name="blood_type"/>
                            <field name="pcr"/>
                        </group>
                        <group string="Status &amp; Assignment">
                            <field name="age" readonly="1" help="Automatically calculated from birth date"/>
                            <field name="state"/>
                            <field name="department_id"/>
                            <field name="capacity" readonly="1"/>
                            <field name="doctors_ids" readonly="not department_id"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Log History">
                            <field name="log_history_ids">
                                <tree create="false" edit="false" delete="false">
                                    <field name="date"/>
                                    <field name="created_by"/>
                                    <field name="description"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Patient form view for user group (doctor fields hidden) -->
    <record id="hms_patient_form_view_user" model="ir.ui.view">
        <field name="name">hms.patient.form.user</field>
        <field name="model">hms.patient</field>
        <field name="groups_id" eval="[(4, ref('hms.group_hms_user'))]"/>
        <field name="priority" eval="20"/>
        <field name="arch" type="xml">
            <form string="Patient">
                <sheet>
                    <group>
                        <group string="Personal Information">
                            <field name="first_name"/>
                            <field name="last_name"/>
                            <field name="email" 
                                   widget="email" 
                                   placeholder="patient@example.com"/>
                            <field name="birth_date" 
                                   required="1" 
                                   help="Age will be automatically calculated from birth date"/>
                            <field name="image" 
                                   widget="image"/>
                            <field name="address"/>
                        </group>
                        <group string="Medical Information">
                            <field name="history" 
                                   invisible="age &lt; 50"/>
                            <field name="cr_ratio" 
                                   required="pcr"/>
                            <field name="blood_type"/>
                            <field name="pcr"/>
                        </group>
                        <group string="Status &amp; Assignment">
                            <field name="age" 
                                   readonly="1" 
                                   help="Automatically calculated from birth date"/>
                            <field name="state"/>
                            <field name="department_id"/>
                            <field name="capacity" 
                                   readonly="1"/>
                            <!-- doctors_ids field hidden for user group -->
                        </group>
                    </group>
                    <notebook>
                        <page string="Log History">
                            <field name="log_history_ids">
                                <tree create="false" 
                                      edit="false" 
                                      delete="false">
                                    <field name="date"/>
                                    <field name="created_by"/>
                                    <field name="description"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Patient tree view -->
    <record id="hms_patient_tree_view" model="ir.ui.view">
        <field name="name">hms.patient.tree</field>
        <field name="model">hms.patient</field>
        <field name="arch" type="xml">
            <tree string="Patients">
                <field name="image" 
                       widget="image" 
                       options="{'size': [90, 90]}"/>
                <field name="first_name"/>
                <field name="last_name"/>
                <field name="email"/>
                <field name="age" widget="char"/>
                <field name="blood_type"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <!-- ==============================
         PATIENT LOG MODULE
         ============================== -->

    <!-- Patient log tree view - readonly for audit trail -->
    <record id="hms_patient_log_tree_view" model="ir.ui.view">
        <field name="name">hms.patient.log.tree</field>
        <field name="model">hms.patient.log</field>
        <field name="arch" type="xml">
            <tree string="Patient Logs" 
                  create="false" 
                  edit="false" 
                  delete="false">
                <field name="date"/>
                <field name="created_by"/>
                <field name="description"/>
            </tree>
        </field>
    </record>

    <!-- Patient log form view - readonly for audit trail -->
    <record id="hms_patient_log_form_view" model="ir.ui.view">
        <field name="name">hms.patient.log.form</field>
        <field name="model">hms.patient.log</field>
        <field name="arch" type="xml">
            <form string="Patient Log" 
                  create="false" 
                  edit="false" 
                  delete="false">
                <group>
                    <field name="patient_id" 
                           readonly="1"/>
                    <field name="created_by" 
                           readonly="1"/>
                    <field name="date" 
                           readonly="1"/>
                    <field name="description" 
                           readonly="1"/>
                </group>
            </form>
        </field>
    </record>

    <!-- ==============================
         DEPARTMENT MODULE
         ============================== -->

    <!-- Department window action -->
    <record id="hms_department_action" model="ir.actions.act_window">
        <field name="name">Departments</field>
        <field name="res_model">hms.department</field>
        <field name="view_mode">tree,form</field>
    </record>

    <!-- Department menu item -->
    <record id="hms_department_menu" model="ir.ui.menu">
        <field name="name">Departments</field>
        <field name="parent_id" ref="hms_menu_root"/>
        <field name="sequence" eval="20"/>
        <field name="action" ref="hms_department_action"/>
    </record>

    <!-- Department form view -->
    <record id="hms_department_form_view" model="ir.ui.view">
        <field name="name">hms.department.form</field>
        <field name="model">hms.department</field>
        <field name="arch" type="xml">
            <form string="Department">
                <group>
                    <field name="name"/>
                    <field name="capacity"/>
                    <field name="is_opened"/>
                    <field name="patients"/>
                </group>
            </form>
        </field>
    </record>

    <!-- Department tree view -->
    <record id="hms_department_tree_view" model="ir.ui.view">
        <field name="name">hms.department.tree</field>
        <field name="model">hms.department</field>
        <field name="arch" type="xml">
            <tree string="Departments">
                <field name="name"/>
                <field name="capacity"/>
                <field name="is_opened"/>
            </tree>
        </field>
    </record>

    <!-- ==============================
         DOCTORS MODULE
         ============================== -->

    <!-- Doctors window action -->
    <record id="hms_doctors_action" model="ir.actions.act_window">
        <field name="name">Doctors</field>
        <field name="res_model">hms.doctors</field>
        <field name="view_mode">tree,form</field>
    </record>

    <!-- Doctors menu item: only visible to manager group -->
    <record id="hms_doctors_menu" model="ir.ui.menu">
        <field name="name">Doctors</field>
        <field name="parent_id" ref="hms_menu_root"/>
        <field name="sequence" eval="30"/>
        <field name="action" ref="hms_doctors_action"/>
        <field name="groups_id" eval="[(4, ref('hms.group_hms_manager'))]"/>
    </record>

    <!-- Doctors form view -->
    <record id="hms_doctors_form_view" model="ir.ui.view">
        <field name="name">hms.doctors.form</field>
        <field name="model">hms.doctors</field>
        <field name="arch" type="xml">
            <form string="Doctor">
                <group>
                    <field name="first_name"/>
                    <field name="last_name"/>
                    <field name="image" 
                           widget="image"/>
                </group>
            </form>
        </field>
    </record>

    <!-- Doctors tree view -->
    <record id="hms_doctors_tree_view" model="ir.ui.view">
        <field name="name">hms.doctors.tree</field>
        <field name="model">hms.doctors</field>
        <field name="arch" type="xml">
            <tree string="Doctors">
                <field name="image" 
                       widget="image" 
                       options="{'size': [90, 90]}"/>
                <field name="first_name"/>
                <field name="last_name"/>
            </tree>
        </field>
    </record>

</odoo>